(function() {

  var app = angular.module('recruitmentApp', ['ngAnimate', 'ngMap']);

  app.controller('contractorDashController', ["$scope", "$http", function($scope, $http) {

    $http.get('/dashboard/get_current_user_type.json').success(function(data){

      var current_user_type = data

      if (current_user_type == "Contractor") {

        $scope.contractor = [];

        $http.get('/dashboard/get_current_contractor.json').success(function(data){
          console.log(data)
          $scope.contractor = data
          $scope.options = [{ name: "unlimited", id:"unlimited" }, { name: "500 miles", id:"500 miles" }, { name: "200 miles", id:"200 miles" }, { name: "100 miles", id:"100 miles" }, { name: "50 miles", id:"50 miles" }, { name: "20 miles", id:"20 miles" }];      
          for(var i = 0; i < $scope.options.length; i++) { 
            if ($scope.options[i].name ==  $scope.contractor.distance_travel){
              $scope.selectedOption = $scope.options[i]
            } 
          }
        })

        $http.get('/jobs.json').success(function(data) {
          $scope.jobs = data
        })

      }

      if (current_user_type == "Employee") {

        $scope.employee = []; 

        $http.get('/dashboard/get_current_employee.json').success(function(data){
          $scope.employee = data
          $http.get('/dashboard/get_current_company_jobs.json').success(function(data){
            $scope.companyjobs = data
          })

        })     
      }
    })

    $scope.putPotentialContractors = function (){
      $http.get('/dashboard/put_potential_contractors.json', { id: $scope.selectedCompanyJob.id }).success(function(data){
          $scope.potentialcontractors = data
      })
    }

    $scope.userHasSearch = function(job) {
      var interested = false
      for(var i =0 ; i < job.jobsearches.length; i++) {
        if (job.jobsearches[i].contractor_id == $scope.contractor.id) {
          if ((job.jobsearches[i].interested == false) || (job.jobsearches[i].interested == null) || (job.jobsearches[i].interested == [])) {
            interested = false
          }else{
            interested = true
          }
        }
      }
      return interested
    }

    $scope.available = function() {

      $http.put('dashboard/update_available_now.json', { id: $scope.contractor.id }).success(function (data){
        if ($scope.contractor.available_now) {
           $scope.contractor.available_now = false
        } else {
           $scope.contractor.available_now = true
          }
      }) 
    }
    $scope.update = function() {
       
        $http.put('dashboard/update_distance_travel.json', { id: $scope.contractor.id, distance_travel: $scope.selectedOption.name }).success(function (data){
        alert("it might have updated?  refresh! ")
      })
    }

    $scope.showjobinterest = function(job) {

      $http.put('dashboard/show_job_interest.json', { contractor_id: $scope.contractor.id, job_id: job.id }).success(function (data){
        // alert("you've succeeded http inside the showjobinterest")
        $http.get('/jobs.json').success(function(data) {
          $scope.jobs = data
        })
      })
    }


  }])

})();